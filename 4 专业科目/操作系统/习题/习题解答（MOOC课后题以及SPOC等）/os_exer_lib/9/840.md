4
(20140606-期末考试试题&参考答案.docx)信号
(12分)在Linux/Unix中，一个用户从shell中执行了一个运行时间较长且不知何时能够结束的程序，Linux
/UNIX可以让用户根据个人需求随时通过敲击Ctrl-
C组合键来终止这个程序的执行。请回答如下问题。要求设计应该具有通用性，列出的设计实现不超过6点，每点不超过4行。问题的执行流程描述不超过8行。
1）如果要在ucore中实现Linux/UNIX同样的功能，请问应该如何修改ucore来支持此功能？
2）uCore的shell也是一个程序，我们希望避免这个shell在执行中被用户敲入的Ctrl-
C所终止，请问在保证1）的要求请看下，如何修改ucore和shell来支持此功能？
3）说明在你的设计下，shell和某一可被终止程序在执行过程中，用户敲击Ctrl-C后，uCore 和shell的执行流程。  
- [x]  

> 知识点：中断、异常与系统调用。
> 出处：网络
> 难度：1
> 1）（4分，信号和杀死进程各2分）
> 需要修改ucore，在中断处理中增加信号（signal）处理机制，为此需要做如下设计：
> 1\. 在中断处理例程中增加对Ctrl+C的按键的识别和处理，一旦收到Ctrl+C按键，则调用do_kill（current
> pid）来杀死当前进程current。
> 备注：如果没有说出do_kill函数，但表达了这个处理过程，可以给分。
> 2） 6分
> 1\. 增加系统调用 signal(SIGID, function addr),让ucore知道用户进程有专门的函数处理信号Ctrl+C对应的信号。（1分）
> 2\. 并在进程控制块中，增加相关field，记录要处理的signal id和对应的用户处理函数地址,目前待处理的signal id。（1分）
> 3\. 在中断处理例程中，如果发现有Ctrl+C按键，则在当前进程的进程控制块中，设置挂起的信号id。（2分）
> 4\. 当前进程在返回用户态时，判断是否有挂起的signal id，如果有，则进一步判断当前的进程是否有要专门处理的signal
> id，如果没有，则调用do_kill来杀死当前进程；如果有，则修改返回用户态的堆栈（返回地址是要signal
> id对应的处理函数地址），让用户进程在返回后执行处理信号的函数。（2分）
> 3) （2分）用户敲Ctrl+C后，ucore的中断处理例程会判断收到了此敲键组合，并在当前进程的进程控制块的记录挂起的singal
> id的域中记录此信息；当当前进程返回用户态前，会执行2）中描述的第4个步骤，完成相关处理。  
