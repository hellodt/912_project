4
"在某些系统中有这样的情况，假如某用户打开文件，向该文件中增加了若干新记录之后没有关闭文件就关机了，当他下次开机再打开文件时却无法读出所增加的新记录。试从打
开文件和关闭文件的作用出发，分析产生这种现象的原因，并说明编程时使用文件的操作的步骤。（写出在编程时使用文件的操作步骤和简要依据。）"
- [x]

知识点:文件系统
出处:网络
难度:1
> 由于文件的控制块（目录）存于磁盘中，有些系统为了减少在多次读写同一文件查目录时盘I/O操作次数，在读写文件前需先执行打开文件操作，它的作用是将要用到的文件目
> 录从磁盘拷到内存，在内存建立内存文件目录表。UNIX系统磁盘上的目录分成索引节点和目录文件目录项，内存文件目录表是活动索引节点表（或称内存索引节点表）和系统
> 打开文件表，分别保存已打开文件的索引节点和文件管理内容，同时在每个进程控制块的User区中设置一张用户文件描述表（又称进程打开文件表），每个打开文件在相应的
> 用户文件描述表目中存储一个指向在系统打开文件表中相应表目位置偏移的指针f。以后的读写文件操作只与内存文件目录表打交道，避免读写盘上文件目录所需的盘I/O操作
> 。同时在读写文件结束后再执行关闭文件操作，它的作用是将内存中修改过的内存文件目录表中的信息写回到磁盘中的文件目录中，避免已修改文件目录信息的丢失。 如果用户
> 打开文件后向该文件中增加了若干新记录，这时文件可能增加存储记录的物理块，相应的内存的文件目录中增加了记录数和新增物理块的地址，而这时磁盘中相应文件的文件目录
> 内容还未改变，它需在执行关闭文件后，将内存文件目录写入磁盘文件目录后才能改变。如没有关闭文件就关机，磁盘中该文件的文件目录中未记入新增的物理块的地址和新增的
> 记录数，当他下次开机再打开文件时，无法找到的新增记录的物理块的地址，也无法读出新增的新记录。
