<html>
<head>
<title>Untitled Document</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<link rel="stylesheet" href="../../../../css/text.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000" leftmargin="5" topmargin="5" marginwidth="5" marginheight="5">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td class="text"> 　　<font color="#003399"><b>（五）D/A变换及输出显示</b></font><a name="05"></a><br>
      　　D/A变换及输出显示<br>
      　　D/A变换后得到图像信号，为了得到全电视信号送到监视器上显示，还得给图像信号加上复合同步和复合消隐信号。<br>
      　　数字式多制式视频信号编码部分的任务是把显示缓存的内容(数字信号)经过D/A变换后，在监视器或电视机上输出。由于帧存储器中保存的是全电视信号的图像部分，经过D/A变换后还不能在电视机上显示输出，为了变成全电视信号还需要模拟产生消隐信号、行同步和场同步等信号。可以用计数器来控制时间，产生消隐信号、行同步和场同步信号。 
      <br>
      　　<font color="#003399">如下图所示：<br>
      </font>　　<img src="../../../../images/chatp/chap02/048.gif" width="282" height="197"><br>
      　　把显示缓存的内容(数字信号)经过D/A变换后，在监视器或电视机上输出时，还要从计数器中设计所有的消隐信号和同步信号，用一个64us的计数器 
      N=640 312.5+312.5=625<br>
      　　计数脉冲为0.1us<br>
      　　<font color="#003399">如下图所示：</font><br>
      　　<img src="../../../../images/chatp/chap02/049.gif" width="272" height="198"><br>
      　　说明：由于计数脉冲为0.1us，所以，从上图可以看到，首先模拟0.7伏的消隐，延迟130个脉冲数时，变为1伏的行同步脉冲，计数满470个脉冲后变为0.7伏，再持续118-47-13 
      us的时间，下面输出的就是帧存储器中的图像信号了。<br>
      　　<img src="../../../../images/chatp/chap02/050.gif" width="286" height="215"> 
      <br>
      <center>
        <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="../../../../../../../../../download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="390" height="330">
          <param name="movie" value="../../../../swf/2-2-5.swf">
          <param name="quality" value="high">
          <embed src="../../../../swf/2-2-5.swf" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="390" height="330"></embed></object>
      </center> <br>
      　　下面的内容是彩色视频信号获取器的工作原理，掌握了黑白视频信号获取器的工作原理后，可以学习下面的内容。<br>
      　　计算机视频信号获取器的总体框图如图2.10所示，工作原理概述如下：视频信号源、摄像机、录像机或激光视盘的信号首先经过A/D变换，送到多制式数字解码器进行解码得到YUV数据，然后由视频窗口控制器对其进行剪裁，改变比例后存入帧存储器。帧存储器的内容在窗口控制器的控制下，与VGA同步信号或视频编码器的同步信号同步，再送到D/A变换器中变成模拟的RGB图像，同时送到数字式视频编辑器中进行视频编码，最后输出到VGA监视器及电视机或录像机。<br>
      　　根据图2.10我们将视频信号获取器分成六大部分，简述如下：<br>
      　　<font color="#003399">图3.10 多媒体计算机视频信号获取器总体框图 </font> <br>
      　　<img src="../../../../images/chatp/chap02/051.gif" width="305" height="163"> 
      <br>
      <font color="#003399">　　1． A/D变换和数字解码</font><br>
      　　从彩色摄像机、录像机或其它视频信号源得到的彩色全电视信号，首先送到视频模拟输入端口，即TDA8708或TDA8709进行A/D变换，TDA8708的工作原理如图3.11所示：它有三个视频输入端通过编程可控制视频选择位0和选择位1，选中3个输入端的任意一个作为输入，然后送到具有钳位电路和自动增益功能的运算放大器中，最后经过A/D变换器将彩色全电视信号转换成8位数字信号，送给彩色多制式数字解码器。A/D变换器的时钟、同步脉冲以及黑电平的同步脉冲，由多制式数字解码电路提供。<br>
      <font color="#003399">　　图3.11 视频模拟输入接口TDA 8708原理方框</font> <br>
      　　<img src="../../../../images/chatp/chap02/052.gif" width="288" height="195"> 
      <br>
      　　全电视信号的峰值电平比较器，黑电平比较器及同步电平比较器，与运算放大器的自动增益控制（AGC）电路一起，减少了放大器的零点漂移，保证了A/D变换器在线性范围内工作。<br>
      　　SAA7191是数字式多制式解码器，它接受8bit CVBS或8bit Y、8bit C super VHS输入支持PAL-B/G、NTSC-M、SECAM等多种电视彩色编码制式。在只使用一个26.8MHz的晶体管时，它所支持的水平有效像素为768（50Hz场频）或640（60Hz场频），它的工作状态可通过I2C总线进行控制。<br>
      　　经SAA7191解码后输出的信号有两种格式，即Y：U：V= 4：1：1和Y：U：V= 4：2：2，其数据组织格式如表3.1所示。由此表可知，4：1：1格式是4个Y像素共用一对U、V，4：2：2格式是2个Y像素共用一对U、V。如前所述，人眼对亮度信号分辨敏感，对彩色空间信号分辨不敏感，因此不必使U、V彩色空间分辨率与Y亮度分辨率相同。事实上Y：U：V= 
      4：1：1的图形质量已达到了一般的电视要求，而Y：U：V= 4：2：2的图像质量已是广播级的了。<br>
      　　<font color="#003399">表3.1 YUV411和YUV422数据格式 </font><br>
      　　<img src="../../../../images/chatp/chap02/053.gif" width="347" height="217"> 
      <br>
      　　SAA7191不仅产生数字式YUV信号，还产生行场同步信号及一些控制信号，如控制A/D转换控制器进行消隐电平钳位的HC信号，指示同步位置以便进行自动增益控制的HSY信号。同时还有离散时间振荡器和数字锁相回路产生的LFCO（行锁定频率控制）信号，LFCO信号送到时钟发生器SAA7197时钟发生器。时钟发生器SAA7197是基于锁相环的同步时钟发生器，在正常工作时能产生输入时钟LFCD的两倍频和四倍频的时钟信号，并能在加电时产生Power-On 
      Reset信号，其主要作用是配合SAA7191或SAA7199（数字式视频信号编码器）产生所须的行锁定时钟，该时钟是整个编码、解码系统的基础，并给这两个芯片提供加电复位信号。<br>
      　　<font color="#003399">2．窗口控制器</font><br>
      　　窗口控制器82C9001A PC-Video是Chips公司生产的适用于ISA总线PC机的视频获取、显示用的专用芯片。其内部功能大致可分为PC总线接口、视频输入剪裁、变化比例变换，输入窗口VGA同步、色键控制以及视频帧存储器VRAM读、写、刷新控制器。PC-Video在视频信号获取器中的作用是集总线接口、窗口控制逻辑和存储器接口于一体。窗口控制器通过对控制状态寄存器编程可以提供下述功能：<br>
      　　① 在计算机图形监视器上，能够显示全屏幕的活动图像；<br>
      　　② 为显示运动图像，PC Video能够改变扫描速度，实现窗口控制；<br>
      　　③ 通过独立的X、Y坐标和彩色键联（Color Key）信号可实现窗口位置控制；<br>
      　　④ 真彩色图像的获取和控制；<br>
      　　⑤ 用广播质量的视频带宽，输入分辨率可达1024×512；<br>
      　　⑥ 支持工业标准视频输入格式，如NTSC，PAL，SECAM，S-VHS，RGB；<br>
      　　⑦ 支持标准4：1：1和4：2：2的YUV，及16位RGB格式；<br>
      　　⑧ 输出放大因子可为2、4和8。<br>
      　　窗口控制器总体逻辑框图如图3.12所示，可分成四部分。 
      <br>
      　　<font color="#003399">图3.12 PC Video窗口控制器 </font> <br>
      　　<img src="../../../../images/chatp/chap02/054.gif" width="287" height="196"><br>
      　　(1) PC总线接口部分。这部分主要包括I/O寄存器地址映射，帧存储地址映射，以及帧存储器读写功能。主机访问PC Video内部功能模块要由这部分控制，同时这部分还包括I2C总线接口和4个用户扩展寄存器选通接口。通过设置寄存器可把PC 
      Video的I/O地址设在128个位置之一帧，存储器的线性地址则可位于系统1MB～15MB的一个空间上。访问方式为16bit字。<br>
      　　(2) 视频输入剪裁、变比例部分。这部分主要功能是把视频数据按照使用者的定义处理后，送到VRAM读写模块中。首先视频数据根据用户的定义确定是选择奇数场或是偶数场，还是选择全帧，紧接着要定义输入窗口的大小和位置。然后再确定是选择捕获窗口外的图像，还是捕获窗口内的图像，或者是选择整个视频图像的有效区域。最后，视频数据可对横向、纵向分别改变比例，改变比例范围为1/64～64/64。改变比例过程是靠周期性的减少像素和扫描行来实现的。因此，对YUV422或YUV411，RGB444等做了不同的处理以保证图像内容的正确性。<br>
      　　(3) VRAM读写、刷新控制部分。这部分主要完成对外接VRAM的访问和选体等的控制。按照PC总线接口部分、视频输入剪裁、变比例部分，以及输出窗口VGA同步、色键控制部分的要求把数据写入或读出帧存储。由于视频获取和PC主机读写都是通过VRAM的随机读写端口，因此两者不能同时进行。而视频数据输出到D/A转换器是通过VRAM的串行数据端口，所以，不论是视频获取，还是主机读写，显示输出均可正常工作。此外，在视频数据写入时，还可设置写屏蔽字，对帧存储器中的某些位禁止写入。帧存的字宽为16bit，空间分辨率为1024×512。<br>
      　　(4) 输入窗口VGA同步、色键控制部分。这部分主要用来驱动帧存储器的数据同VGA的视频信号同步读出，并送到D/A转换器变成模拟的RGB信号，然后通过一个模拟开关与VGA视频信号叠加输出到VGA监视器上。模拟开关的控制信号可以是：(a) 
      定义一个显示窗口；(b) 定义某个彩色键值，当色键值与VGA输入数据值相等时，即称色键匹配；根据（a）、（b）定义的VGA屏幕可产生4个不同的区域，如图3.13所示，可对任意区域选择视频输出或VGA输出。图3.13中F0为非窗口，非色键区；F1为窗口区，非色键区；F2为非窗口区，色键区；F3为窗口和色键共同作用的区域。
<br>
      <font color="#003399">　　图3.13 VGA屏幕叠加效果</font><br>
      　　<img src="../../../../images/chatp/chap02/055.gif" width="295" height="205"> 
      <br>
      <font color="#003399">　　3．帧存储器系统</font><br>
      　　PC Video控制图像的采集和存储，采集数据率高达14.75MHz，即要求最小访问时间小于67ns。而设计中选用的VRAM是TC524256Z-10，其访问时间约为100ns。为解决存储速度问题，采用了双体结构的存储器，即顺序的两个像素一次打入两个存储体，使访问周期下降到134ns。TC524256Z-10有一个随机端口，还有一个串行访问端口，当输出像素数据时，其串行输出的时钟为像素时钟的1/2频率，用锁存器和数据选择器将两个存储体的输出交替送入D/A转换器，其原理框图及时序图如图3.14所示。图中DATA 
      A为存储器0体的输出，DATA B为存储器1体的输出，SRCLK为串行访问口时钟。串行数据在行消隐期间打入内部移位寄存器中。<br>
      　　<font color="#003399">图3.14 双体存储器工作原理</font><br>
      　　<img src="../../../../images/chatp/chap02/056.gif" width="219" height="248"><br>
      　　帧存储器的主要作用有三个：<br>
      　　(1) 从摄像机来的视频信号，经过A/D变换，数字解码，在视频窗口控制器的控制下，将它们实时地存到帧存储器中，大约74ns存一个像素数据。<br>
      　　(2) 彩色监视器每隔74ns要从帧存储器中取一个像素数据（在视频信号正程时），经D/A转换，变成模拟的RGB信号，供彩色监视器显示帧存储器中真彩色全屏幕运动图像使用。<br>
      　　(3) 计算机可以通过视频窗口控制器，对帧存储器的内容进行读写操作。帧存储器的视频像素信息读到计算机后，通过编程可以实现各种算法，完成视频图像处理的任务。同时也可完成帧存储器的存盘和读盘的任务。 
      <br>
      　　<font color="#003399">4．数模转换和矩阵转换</font><br>
      　　这部分由两个器件组成，即D/A转换器SAA9065和视频信号处理器TDA4680。<br>
      　　SAA9065是YUV方式的视频D/A转换器，其输入数据为YUV411或YUV422的视频数据。最高数据率为30MHz，内部设有色差信号插值电路和增强图像用的滤波器。输出是Y、-（R-Y）、-（B-Y）或Y、R-Y、B-Y，1V峰值（75欧）信号。内部功能控制通过I2C总线实现。<br>
      　　TDA4680是用于处理亮度和色度信号的模拟电路，其输入是Y、-（R-Y）、-（B-Y），输出是R、G、B。TDA4680本来是作为彩色电视机显像管电子枪的前级，此处用来实现YUV到RGB的转换，以及对亮度、色饱和度、对比度等参数的调整。<br>
      　　YUV到RGB的转换是通过一个YUV-RGB矩阵变换网络变成RGB，其中矩阵因子因制式不同稍有差别，目的是补偿信号传输中的失真。<br>
      　　5．视频信号和VGA信号的叠加<br>
      　　视频输出的RGB信号和从VGA显示卡上引过来的信号是完全同步的，因为PC Video的输出是靠VGA的同步信号驱动的，所以用适当的方法交替地切换两路信号，即可实现两路输出的叠加。由于两路信号均为模拟信号，因此选用了模拟开关电路实现两信号的叠加，具体器件为74HCT4053，模拟开关的控制信号由PC 
      Video给出，控制模拟开关在两路信号间切换，从而实现了输入视频信号在VGA监视器上的窗口显示和彩色键联。<br>
      　　什么是彩色键联 Color Key呢？就是将视频信号、计算机输出图像和字符信号叠加在一起，是通过彩色键联Color Key 信号完成的，具体方法如下： 
      <br>
      　　<img src="../../../../images/chatp/chap02/057.gif" width="401" height="152"> 
      <br>
      　　计算机输出VGA卡的信号与视频获取器的视频信号通过二选一的开关同时送给视频监视器输出，如果选择开关为0是VGA卡输出，选择开关为1时为视频信号输出。通过逻辑电路和编程软件，我们可以设计成：VGA卡显示缓存为白色时，使开关信号为1，允许视频输出，其它彩色时开关为0，为VGA卡输出。这样，我们把VGA卡底色设计为白色，字和图为其它颜色，结果就给视频信号叠加上字和图。我们可以设计任何一种颜色，使开关信号为1，允许视频信号输出，所以称之为彩色键联Color 
      Key。 <br>
      　　<img src="../../../../images/chatp/chap02/058.gif" width="269" height="193"> 
      <br>
      <font color="#003399">　　6．数字式多制式视频信号编码部分</font><br>
      　　这部分只选用了数字式多制式视频信号编码器SA7199。它是以数字方式进行视频信号编码的编码器，支持PAL和NTSC两种制式，输出有CVBS和Super 
      VHS两组信号，工作模式有4种，可借助软件利用I2C总线进行控制。4种模式的主要区别是同步信号的产生方式，即同步信号可由编码器根据自身的时钟产生，也可由外部电路产生，或者还可以由编码器和外部信号同步产生。输入数据可是YUV，也可是RGB。SAA7199内部设有3×256字节的查找表，用于γ校正等查找表运算，比如对比度、色调等运算，该查找表也可跳过不用。若输入数据为RGB，要经过一个内部转换矩阵变成YUV，送到内部全数字方式工作的编码器中进行编码，编码后的数字信号经内部D/A转换后输出模拟视频信号。<br>
      　　彩色视频信号获取器主要由下述几部分组成：<br>
      　　・A/D变换和数字解码；<br>
      　　・窗口控制器； <br>
      　　・帧存贮器系统；<br>
      　　・数据转换和矩阵变换；<br>
      　　・视频信号和VGA信号的叠加；<br>
      　　・数字式多制式视频信号编码器。<br>
    </td>
  </tr>
</table>
</body>
</html>
